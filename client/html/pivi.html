

<html>
  <head>

<meta name='apple-mobile-web-app-capable' content='YES' />
<meta name="viewport" content="width=device-width,initial-scale=1">

    <title>PiVi Jukebox</title>
    <script type="text/javascript" src="../js/jquery-1.6.2.js"></script>
    <script  type="text/javascript" src="../js/jquery-ui.js"></script>
    <style>
      body { 
          background-color:#ccc;
          font-family: Calibri, arial, helvetica;
      }

    .header, .addfile,.addcategory {
          font:bold 20px helvetica;
          color: #333;
          text-shadow: -1px -1px 1px #fff;
      }

      .addfile {
          float:right;
          margin-right:10px;
      }

      .list div {
          background-color:#fff;
          margin:4px;
          min-height:40px;
          padding:3px;
          border-radius:5px;
          -webkit-box-shadow: 0px 1px 2px #444;
          box-shadow: 1px 1px 2px #444;
      }



      #np { 
          position:fixed;
          background-color:#ddd;
          right:0px;
          top:0px;
          left:0px;
          padding:3px;
          -webkit-box-shadow: 0px 1px 1px #444;
          box-shadow: 1px 1px 1px #444;
      }
      
      #npshadow {
          min-height:84px;
      }

      #stop, #pause, #rewind, #forward, #resume, #louder, #quieter,  #edit { 
          background-color: rgba( 255,255,255,0.5);
          float:left;
          margin:4px;
          min-height:20px;
          padding:3px;
          border-radius:5px;
      }

      #isplaying {
          display:none;
      }
      #isstopped {
          display:none;
      }
      #ispaused {
          display:none;
      }

      #edit {
          float:right;
      }

      #playing { 
          clear: both;
          background-color: rgba( 243,243,200,0.5);
          margin:4px;
          font-size:20px;
          min-height:20px;
          padding:3px;
          border-radius:5px;
      }

    </style>

    <script type="text/javascript">

      jQuery(document).ready( function() {
          $ = jQuery;
      

          function play(file) {
              $('#stop').show();
              $.get("/play", {filename:file}, function (data) {
//                  alert(JSON.stringify(data));
                  jQuery('#playing').text(data.playing);
              }
                    , "json");
          }
          
          function listVideos(videoListing,element) {
              $(element).empty();
              videoListing.forEach( function (directory) {
                  $(element).append('<div class="addfile" dir="' + directory.directory + '">+</div><div class="header">' + directory.directory + '</div>');
                  var category = $('<div class="list"></div>').appendTo($(element));
                  directory.files.forEach( function(video) {
                      videoTitle = video.match(/.*?(?=-\S)/);
	              category.append("<div file=\"" + directory.directory +'/' +video + "\">" + videoTitle + "</div>");
                  })
              });
              $(element).append('<div class="addcategory" >Add category</div>');
              $('.list').click( function(e) {
                  $(e.srcElement).css("backgroundColor","#cfc");
                  setTimeout(function(){$(e.srcElement).css("backgroundColor","white")},500);
                  play($(e.srcElement).attr("file"));
              });

              $('.addfile').click( function(e) {
                  var directory = $(e.srcElement).attr("dir");
                  var youtubeurl = prompt('Enter URL to add to ' + directory);
                  addVideo(youtubeurl,directory);
              });
              $('.addcategory').click( function(e) { 
                  var categoryName = prompt('Enter name of new category');
                  addCategory(categoryName);
              });

	  }          

          function getListing() {
              $.get("/dir", {},
                  function (data) { 
                      listVideos(data,"#videos")
                  }, "json");
          }

          function addVideo(url, directory) {
              jQuery('#playing').html( 'Downloading: '+url);
              $.get("/add", {url:url, directory:directory},
                  function (data) { 
                      jQuery('#playing').html( 'Downloaded: '+url);
                      getListing();
                  }, "json");
          }

          function addCategory(name) {
              $.get("/addcategory", {name:name},
                  function (data) { 
                      jQuery('#playing').html( 'Category ' + name + ' added.');
                      getListing();
                  }, "json");
          }

     	  getListing();

           $('#stop').click( function(e) {
                  $('.ispaused').hide();
                  $('.isplaying').hide();
                  $('.isstopped').show();
                  play("<stop>");
                  jQuery('#playing').html("");
           });


           $('#pause').click( function(e) {
                  $('.ispaused').show();
                  $('.isplaying').hide();
                  $('.isstopped').hide();
                  play("<pause>");
           });


           $('#rewind').click( function(e) {
                  play("<rewind>");
           });

           $('#backward').click( function(e) {
                  play("<backward>");
           });

           $('#forward').click( function(e) {
                  play("<forward>");
           });

           $('#louder').click( function(e) {
                  play("<louder>");
           });

           $('#quieter').click( function(e) {
                  play("<quieter>");
           });



           function scrollDiv(element) {
               element= '#playing';
               $(element).css("scrollLeft", $(element).css("scrollLeft")-1);
               if ($(element).css("scrollLeft") < -200) {
                  $(element).css("scrollLeft", 0) 
               }
           }
           setInterval(scrollDiv,200);


	});


    </script>
  </head>
  <body>
    <div id='np'>
      <div class="isplaying" id="stop">Stop</div>
      <div class="isplaying"  id="pause">Pause</div>
      <div id="rewind">Rewind</div>
      <div id="forward">Forward</div>
      <div class="ispaused" id="resume">Resume</div>
      <div id="louder">+</div>
      <div id="quieter">-</div>
      <div id="edit">Edit</div>
      <div id='playing'> </div>
    </div>
    <div id='npshadow'></div>
    <div id="videos"></div>
  </body>
  
</html>
